<?xml version="1.0" encoding="UTF-8"?>

<!-- 
 ! Filename: persist.xml
 !
 ! Author:   Greg Crider
 ! Date:     16 October 2008
 !
 ! Purpose:  This context file contains beans used for persistence related operations.
  -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
                           http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-2.0.xsd">

	<!-- DATA SOURCE -->

	<!-- Connection Pool -->
	<bean id="persist.dataSource"
	      class="org.apache.commons.dbcp.BasicDataSource"
	      destroy-method="close">
		<property name="driverClassName"><value>${db.pool.driver}</value></property>
		<property name="url"><value>${db.pool.url}</value></property>
		<property name="username"><value>${db.pool.userid}</value></property>
		<property name="password"><value>${db.pool.passwd}</value></property>
		<property name="initialSize"><value>${db.pool.initsize}</value></property>
		<property name="maxActive"><value>${db.pool.maxactive}</value></property>
		<property name="validationQuery"><value>${db.pool.validationquery}</value></property>
		<property name="testOnBorrow"><value>${db.pool.testonborrow}</value></property>
	</bean>
	
	<!-- HIBERNATE SESSION FACTORY -->
	
	<!-- 
	 ! The session factory will tie in the above named data source bean, and will
	 ! use a standard Hibernate configuration file (expcept without the normal session
	 ! factory setup).
	  -->
	<bean id="persist.sessionFactory" 
		class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
		<property name="dataSource" ref="persist.dataSource"/>
		<property name="configLocation" value="classpath:hibernate/hibernate.cfg.xml"/>
	</bean>
	
	<!-- DATA ACCESS OBJECTS -->
	
	<!-- 
	 ! Inject common attributes for all DAO's regardless of their concrete implementation.
	  -->
	<bean id="persist.abstractDao"
		abstract="true">
	</bean>
	
	<!-- 
	 ! Inject common attributes for all Hibernate 3 based DAO's.
	  -->
	<bean id="persist.abstractHibernateDao"
		parent="persist.abstractDao"
		class="org.ccci.gcx.idm.common.persist.hibernate.AbstractDao"
		abstract="true">	
		<property name="sessionFactory">
			<ref bean="persist.sessionFactory"/>
		</property>
	</bean>
	
	<!-- DAO Implementations -->

	<bean id="persist.auditDao" parent="persist.abstractHibernateDao"
		class="org.ccci.gcx.idm.core.persist.hibernate.AuditDaoImpl" />

	<bean id="persist.gcxUserDao" parent="persist.abstractHibernateDao"
		class="org.ccci.gcx.idm.core.persist.hibernate.GcxUserDaoImpl" />
</beans>
