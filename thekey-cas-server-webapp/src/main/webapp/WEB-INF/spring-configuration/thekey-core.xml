<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:lang="http://www.springframework.org/schema/lang"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	                    http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-3.0.xsd
	                    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd">

	<bean id="util.randomPassword" class="org.ccci.gto.cas.util.RandomPasswordGenerator">
		<property name="maxDigits" value="${password.maxdigits}" />
		<property name="startWithLetter" value="${password.startwithletter}" />
	</bean>

	<bean id="thekeyViewInterceptor" class="org.ccci.gto.cas.web.servlet.TheKeyViewInterceptor">
		<property name="languages">
			<bean class="org.ccci.gto.cas.services.web.LanguagesList">
				<property name="location" value="messages/languages.properties" />
			</bean>
		</property>
	</bean>

	<bean id="service.auditService" class="org.ccci.gto.cas.service.audit.AuditServiceImpl">
		<property name="auditDao" ref="persist.auditDao" />
	</bean>

	<bean id="service.gcxUserService" class="org.ccci.gcx.idm.core.service.impl.GcxUserServiceImpl">
		<property name="daoGroup">
			<map>
				<entry key="persist.gcxUserDao" value-ref="persist.keyUserDao" />
			</map>
		</property>
		<property name="auditService" ref="service.auditService" />
		<property name="mailSender" ref="mail.mailSender" />
		<property name="userDao" ref="ldap.gcxUserDao" />
		<property name="randomPasswordGenerator" ref="util.randomPassword" />
		<property name="newPasswordLength" value="${password.length}" />
		<property name="newPasswordTemplate" ref="mail.templateNewPassword" />
		<property name="activationTemplate" ref="mail.templateActivation" />
		<property name="messageSource" ref="messageSource" />
		<property name="replyTo" value="${mail.replyto}" />
		<property name="loginUri" value="${gcx.loginurl}" />
	</bean>

	<bean id="themeResolver" class="org.ccci.gto.cas.services.web.TheKeyThemeResolver">
		<property name="defaultThemeName" value="${cas.themeResolver.defaultThemeName}" />
		<property name="argumentExtractors" ref="argumentExtractors" />
		<property name="populators">
			<list>
				<bean class="org.ccci.gto.cas.services.web.MobileViewPopulator">
					<property name="mobileBrowsers">
						<map>
							<entry key=".*iPhone.*" value="iphone" />
							<entry key=".*Android.*" value="iphone" />
							<entry key=".*Safari.*Pre.*" value="iphone" />
							<entry key=".*Nokia.*AppleWebKit.*" value="iphone" />
						</map>
					</property>
				</bean>
				<bean class="org.ccci.gto.cas.css.services.web.CssViewPopulator" />
			</list>
		</property>
	</bean>

	<!-- css scrubber service -->
	<bean id="cssScrubber" class="org.ccci.gto.cas.css.scrubber.ParsingCachingCssScrubber">
		<property name="blockedTypes">
			<list>
				<!-- block imports which can circumvent other css filters -->
				<util:constant static-field="org.w3c.dom.css.CSSRule.IMPORT_RULE" />
			</list>
		</property>
		<property name="blockedProperties">
			<list>
				<!-- behavior css attribute which embeds a script that is run -->
				<value>behavior</value>
				<value>-mm-behavior</value>
			</list>
		</property>
		<property name="blockedPropertyValues">
			<list>
				<!-- microsoft ie css expressions -->
				<value>expression</value>
			</list>
		</property>
		<property name="cache">
			<bean class="org.apache.jcs.JCS" factory-method="getInstance">
				<constructor-arg value="cssCache" />
			</bean>
		</property>
	</bean>

	<!-- Ticket validation -->
	<bean id="validateControllerAdvisor" class="org.springframework.aop.support.NameMatchMethodPointcutAdvisor">
		<property name="advice">
			<bean class="org.ccci.gto.cas.web.ServiceValidateControllerAdvice">
				<property name="gcxUserService" ref="service.gcxUserService" />
			</bean>
		</property>
		<property name="mappedName" value="handleRequest" />
	</bean>

	<!-- i18n -->
	<bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
		<property name="cacheSeconds" value="60" />
		<property name="basenames">
			<list>
				<value>classpath:messages/idm</value>
				<value>classpath:messages/mailmessage</value>
				<value>classpath:messages</value>
			</list>
		</property>
		<property name="fileEncodings" value="UTF-8" />
		<property name="defaultEncoding" value="UTF-8" />
	</bean>
</beans>
